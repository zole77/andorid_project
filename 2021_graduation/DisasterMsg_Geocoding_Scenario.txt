지오코딩이란 주소를 GPS로 바꾸는 기능이다.

우리의 목표: 재난문자에서 ( ) 안 워딩들을 지오코딩해서 GPS를 받아오고 관리하는 것.


생각한 방안
Q1. 백그라운드에서 재난문자를 요청하고, 지오코딩이 가능한가?
A1. 아직 알 수 없음.


Q2. 만약 가능하다면 어떻게 받고 관리할 수 있는가?
A2. 사용자 방문위치를 지오코딩함 => 이 말인 즉, 사용자 기기에 저장된 SQLite DB에서 뽑아낸 것을 지오코딩한다는 말이 됨. (O)

예제. 이용자 최지혁 군은 4월 13일 오늘 다음과 같은 장소가 DB에 저장되었음.

2021년04월13일
- 대한민국	부산광역시	사하구	|	다대동 다송로36
- 대한민국	충청북도		진천군	|	진천읍 중앙서3길 6
- 대한민국	경상남도		창원시	|	의창구 봉림동 창원대학로20
- 대한민국	인천광역시	계양구	|	계산4동 장제로 822

공통점이 보이는가? 다음 주소들은 (대한민국) OOO OOO의 양식을 가지고 있으며
OOO OOO은 csv파일에서도 알 수 있듯이 locale_id 가 구분되는 주소들임.
따라서, 사용자 기기에 저장된 SQLite DB에서 뽑아낸 주소들로 locale_id를 뽑아낼 수 있음.
(되는 지 확실치 않음 현재 뇌피셜로 그림만 그려둔 상태임)


SQL DB에서 뽑아낸 주소들로 location_id를 뽑아내는 방법
- 부산광역시 사하구

부산광역시 사하구이면)

	-> 부산광역시 사하구 랑 부산광역시 전체라는 키워드를 equlas 비교해서, 재난문자를 조회 
	-> 부산광역시 사하구 문자랑 부산광역시 전체 문자 두개 다 조회가 가능하다
	-> 문자 하나가 검색될때마다 ( ) 안 워딩을 지오코딩하고 결과값이 있으면)
		-> GPS와 재난문자 내용 전체를 DB에 저장



1. 이렇게 뽑아낸 locale_id로 재난문자를 조회함.
2. 재난문자에서 ( ) 안 워딩들을 지오코딩하고 결과값이 있으면 GPS와 재난문자 내용 전체를 DB에 저장함. (이 DB를 지오DB라 칭함)
3. 사용자 동선과 지오DB 안의 GPS들을 각각 거리비교해서 일정 거리 이내 경고 표시와 함께 경고마커를 띄우고 해당 마커 클릭시 저장했던 재난문자 내용 출력

=================================
++ 2021.04.16

재난문자에서 ( ) 안 워딩들을 지오코딩하고 결과값을 뽑아내는데 까지 성공했음. 결과값 확인 끝.
( )안에 주소 형태의 워딩이 있다면 뽑아냄.

3번기능 구현이 되면 사용자 동선과 지오 DB안의 GPS들을 거리비교해서 일정 거리 이내 경고 표시를 주는 기능이 실행될 것임.

이제 고민해야할 것

- Service 단 -
ⓐ 재난문자는 어떠한 간격으로 받아올 것인가? 사용자 위치처럼 10분에 한번씩 요청? 아니면 시간 단위나 하루 단위 등으로 기간을 넓게 잡고 한번에 정산?

- 하루 단위로 지정, 일평균 재난문자는 4월2일부로 정부 지침아래 260개에서 100개 남짓으로 줄어듬. 따라서, 현재 요청하는 1000개 단위의 재난문자로도 대략 일주일치의 위치정보를 정리할 수 있음. 23시59분 또는 00시 기준. 재난문자를 api로 요청

ⓑ 지오DB에 대한 관리는 어떻게 할 것인가? 사용자 위치 DB는 데이터의 반복 저장을 피하는 형태로 설계했고 사용자에게 직접 테이블 삭제에 대한 기능도 제공해서 어느정도 관리가 되는 상황이지만, 지오 DB는 일단 주소 형태의 워딩이면 재난문자에서 가져오기 때문에 반복 데이터에 대한 저장, 추가적인 데이터가 발생했을 때 상황이 정리되지 않았음.

- 지오DB는 SQLite 아래 새로운 디비를 만들고, 테이블은 하나로 설정. 
- ⓐ에서 설정한 주기에 따라서 재난문자를 받아오면 받아온 내용으로 DB를 업데이트, DB내용을 추가하는 과정에서 반복되는 데이터가 있으면 추가하지 않고 다음 정보로 넘어가는 코드를 삽입해야함.

ⓒ 3번기능 구현을 위해서는 사용자 동선과 지오 DB안의 GPS거리들을 distance() 함수로 비교해야함. 이를 어떻게 비교할 것인가? 사용자 위치테이블을 모두 훑어보면서 일일이 distance()함수로 비교할것인가? 

- 좀 더 고민을 해봐야겠지만, 사용자 기기에 설정된 현재 날짜 기준 2주 까지의 데이터를 저장하고, 2주 이상 지난 테이블은 삭제하는 방향을 고려중임.
- 여기에 맞춰 비교하는 DB테이블은 14개의 사용자 위치 정보와 모두 비교
- 성능에 대한 부분은 구현 후 생각...

ⓓ 경고횟수에 대한 고민도 필요. 가령, 사용자 자택과 코로나 발생지가 일정 거리 이내라서 그간 사용자가 저장해놨던 테이블 갯수만큼 경고가 감지되는 불필요한 알림이 연출될 수 있음. 이것에 대한 고민 필요.


- 재난문자 제공 기능 -
ⓐ 현재는 재난문자를 단순히 1000개까지 가져와서 보여주고 있다. 하지만 사용자가 추가적으로 과거의 재난문자를 더 보고 싶어한다면 방법이 있는가? 가령, 2000개 3000개에 대한 요청까지 가능한가?
- firebase에 서버를 하나 두고, 거기에 업데이트를 하는 식으로 진행하고 있음.

ⓑ 현재 구현된 재난문자를 분류해내는 로직이 코드적으로 볼때 너무 복잡하거나 무거워지진 않는가? 기기에 직접 실험해봐야 좀 더 와닿을 문제로 추정됨.
- 기기에 실험결과 요청하는 즉시 잘 뽑아내는 것으로 확인했음. 코드로 볼때는 난해한 편이지만 퍼포먼스로는 큰 영향이 없는 것 같다.

ⓒ 사용자가 다녀갔던 위치 포함 사용자 위치 중심으로 재난 문자 제공이 가능한가? 가능하다면 어떻게 할 것인가?
- 현재 사용자 DB에서 뽑아내는 SigunguDB로 재난문자를 조회한다면 가능함. 재난문자를 눌렀을 때, 첫 레이아웃으로 사용자 위치 중심의 재난문자를 먼저 보여주고 그 뒤에 선택해서 볼 수 있는 화면으로 넘기는 방안을 생각중임.

ⓓ 위 3가지 문제를 해결했다면, 시도별 확진자 수에 대한 데이터 시각화에 대한 고민 필요.
- 표와 지도로 해결함.

=============================================================
※ 현재까지의 개발 진행 상황

지금 어플리케이션에서 쓰고 있는 DB는 총 4가지임. 이 중 3가지가 사용자 기기내에 SQLite를 활용하고 있고, 나머지 하나는 firebase에 저장된 재난문자 DB임.

재난문자 DB는 실시간 데이터베이스로, 30분마다 한번씩 노트북에서 업데이트를 실행함. 지금까지 대략 3000개가 조금 안되는 문자가 쌓였음. 하루 재난문자 발생량이 100개정도인 것을 감안하면 약 한달정도의 재난문자량을 저장하고 있다고 보면됨.

사용자 기기내에서 쓰는 3가지의 DB는 다음과 같음.
- UserDB (DB_Date)
- SigunguDB
- GeoDB

UserDB 는 사용자의 위치 정보를 날짜별로 담고 있는 데이터베이스
SigunguDB는 사용자의 위치 정보에서 시군구만을 뽑아낸 데이터베이스
GeoDB는 SigunguDB에서 뽑아낸 시군구를 바탕으로 해당 지역의 재난문자만 뽑아내서 재난문자속에 있는 위치정보를 담고 있는 데이터베이스



만들 것
- 재난문자 갱신해서 사용자 위치와 비교하는 기능 추가
- 사용자 방문위치 기반해서 재난문자 종합해서 보여주는 기능 추가